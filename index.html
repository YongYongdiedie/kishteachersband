<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KISH 교사 밴드 포털 · Cloud</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>🎵 KISH 교사 밴드 포털 · Cloud</h1>
      <div class="headBtns" id="userBar" style="display:none"></div>
    </header>

    <!-- AUTH SCREEN -->
    <section id="authScreen" class="authWrap">
      <div class="tabsAuth">
        <button class="tab active" id="tabLogin">로그인</button>
        <button class="tab" id="tabSignup">회원가입</button>
      </div>
      <div id="loginPane" class="card">
        <div class="field"><label>이메일</label><input id="loginEmail" type="email" placeholder="예: admin@kishband.org"></div>
        <div class="field"><label>비밀번호</label><input id="loginPw" type="password" placeholder="비밀번호"></div>
        <button class="btn accent" id="loginBtn">로그인</button>
        <div class="muted" style="margin-top:10px">관리자(최초): <b>ADMIN_EMAIL</b></div>
      </div>
      <div id="signupPane" class="card" style="display:none">
        <div class="field"><label>이름</label><input id="suName" type="text" placeholder="실명 입력"></div>
        <div class="field"><label>이메일(로그인용)</label><input id="suEmail" type="email" placeholder="예: you@school.kr"></div>
        <div class="field"><label>비밀번호</label><input id="suPw" type="password" placeholder="비밀번호(6자 이상)"></div>
        <div class="field"><label>비밀번호 확인</label><input id="suPw2" type="password" placeholder="비밀번호 확인"></div>
        <div class="field"><label>부서</label><input id="suDept" type="text" placeholder="예: 과학과"></div>
        <div class="field"><label>담당 파트</label>
          <select id="suPart">
            <option value="일렉기타">일렉기타</option>
            <option value="베이스기타">베이스기타</option>
            <option value="보컬">보컬</option>
            <option value="피아노">피아노</option>
            <option value="신디사이저">신디사이저</option>
            <option value="직접입력">직접입력</option>
          </select>
        </div>
        <div class="field" id="suPartCustomWrap" style="display:none"><label>담당 파트(직접입력)</label><input id="suPartCustom" type="text" placeholder="예: 색소폰"></div>
        <button class="btn accent" id="signupBtn">회원가입 요청</button>
        <div class="muted" style="margin-top:10px">※ 가입 후 관리자가 승인해야 로그인 가능합니다.</div>
      </div>
    </section>

    <!-- APP SCREEN -->
    <section id="appScreen" style="display:none">
      <div class="tabs" id="mainTabs">
        <button class="tab active" data-tab="playlist">플레이리스트</button>
        <button class="tab" data-tab="board">자유게시판</button>
        <button class="tab" data-tab="admin" id="adminTab" style="display:none">관리자</button>
      </div>

      <!-- PLAYLIST TAB -->
      <section id="tab-playlist">
        <div class="subbar">
          <div class="search" role="search">
            <select id="searchField" aria-label="검색 필드">
              <option value="title">제목</option>
              <option value="artist">가수</option>
            </select>
            <div class="autocomplete" style="flex:1">
              <input id="searchInput" type="text" placeholder="검색어 입력 (자동완성)" aria-label="검색" autocomplete="off" />
              <div id="acMenu" class="ac-menu" style="display:none"></div>
            </div>
            <button id="clearSearch" class="btn" title="검색 지우기">지우기</button>
          </div>
          <span class="pill">정렬: 한글 자음 순 (제목)</span>
          <div class="headBtns">
            <button id="byPersonBtn" class="btn" title="담당자별 곡 및 파트 확인">담당자별 곡 및 파트 확인</button>
            <button id="addBtn" class="btn accent" title="곡 추가">+ 곡 추가</button>
          </div>
        </div>
        <div id="list" class="list"></div>
        <div id="empty" class="empty" style="display:none">아직 등록된 곡이 없습니다. <b>+ 곡 추가</b> 버튼을 눌러 시작하세요.</div>
      </section>

      <!-- BOARD TAB -->
      <section id="tab-board" style="display:none">
        <div class="rowHead" style="margin-bottom:10px">
          <div style="font-weight:700">자유게시판</div>
          <button class="btn accent" id="postNewBtn">+ 글쓰기</button>
        </div>
        <div class="muted" style="margin-bottom:10px">질문이나 건의사항 등 자유롭게 작성 가능합니다.</div>
        <div class="card">
          <table class="board" id="boardTable" style="border-spacing:0">
            <thead>
              <tr><th style="width:70px">순번</th><th>제목</th><th style="width:160px">작성자</th><th style="width:200px">작성일</th><th style="width:220px">관리</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="boardEmpty" class="empty" style="display:none">작성된 글이 없습니다.</div>
        </div>
      </section>

      <!-- ADMIN TAB -->
      <section id="tab-admin" style="display:none">
        <div class="rowHead" style="margin-bottom:10px">
          <div style="font-weight:700">가입 승인 대기 목록</div>
        </div>
        <div class="card">
          <table class="board" id="signupTable" style="border-spacing:0">
            <thead>
              <tr><th>이름</th><th>이메일</th><th>부서</th><th>담당 파트</th><th>가입일</th><th style="width:240px">승인/거절</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="signupEmpty" class="empty" style="display:none">대기 중인 신청이 없습니다.</div>
        </div>

        <div style="height:16px"></div>
        <div class="rowHead" style="margin-bottom:10px">
          <div style="font-weight:700">사용자 관리</div>
        </div>
        <div class="card">
          <table class="board" id="usersTable" style="border-spacing:0">
            <thead>
              <tr><th>이름</th><th>이메일</th><th>부서</th><th>담당 파트</th><th>권한</th><th style="width:360px">관리</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="usersEmpty" class="empty" style="display:none">등록된 사용자가 없습니다.</div>
        </div>

        <div style="height:16px"></div>
        <div class="rowHead" style="margin-bottom:10px">
          <div style="font-weight:700">관리자 로그</div>
        </div>
        <div class="card">
          <div class="muted">로그는 클라우드 Firestore의 <code>logs</code> 컬렉션에 저장됩니다.</div>
        </div>
      </section>
    </section>
  </div>

  <!-- SONG DIALOG (Add/Edit) -->
  <dialog id="songDlg">
    <form id="songForm" method="dialog">
      <div class="dlgHead">
        <div style="font-weight:800">곡 정보 입력</div>
        <button id="closeDlg" class="btn" value="cancel" type="button">닫기</button>
      </div>
      <div class="dlgBody">
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
          <div class="field"><label for="title">제목*</label><input id="title" name="title" type="text" required /></div>
          <div class="field"><label for="artist">가수*</label><input id="artist" name="artist" type="text" required /></div>
          <div class="field"><label for="version">버전</label><input id="version" name="version" type="text" placeholder="예: 원곡/어쿠/락ver." /></div>
        </div>

        <div class="partsEditor" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin:12px 0 6px">
            <label style="display:block;color:#c9d1d9;font-weight:700">파트별 담당자/링크/공유</label>
            <button id="addPartBtn" type="button" class="btn" title="파트 추가">+ 파트 추가</button>
          </div>
          <table class="parts">
            <thead>
              <tr>
                <th style="width:180px">파트</th>
                <th style="width:28%">담당자</th>
                <th>예시 링크(유튜브 등)</th>
                <th>기타/공유(드라이브 등)</th>
              </tr>
            </thead>
            <tbody id="partsTbody"></tbody>
          </table>
        </div>
      </div>
      <div class="dlgFoot">
        <button class="btn" value="cancel" type="button" id="cancelBtn">취소</button>
        <button class="btn accent" id="saveBtn" type="submit">완료</button>
      </div>
    </form>
  </dialog>

  <!-- BY PERSON DIALOG -->
  <dialog id="personDlg">
    <div class="dlgHead">
      <div style="font-weight:800">담당자별 곡 및 파트 확인</div>
      <button id="closePersonDlg" class="btn" type="button">닫기</button>
    </div>
    <div class="dlgBody">
      <div class="search" role="search">
        <div class="autocomplete" style="flex:1">
          <input id="personInput" type="text" placeholder="이름 입력 (자동완성)" autocomplete="off" />
          <div id="personAcMenu" class="ac-menu" style="display:none"></div>
        </div>
        <button id="personClear" class="btn" title="검색 지우기">지우기</button>
      </div>
      <div style="margin-top:12px">
        <table class="parts" id="personTable">
          <thead>
            <tr><th>곡</th><th>가수</th><th>버전</th><th>담당 파트</th><th>예시 링크</th><th>공유 링크</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="personEmpty" class="empty" style="display:none">담당된 곡이 없습니다.</div>
      </div>
    </div>
  </dialog>

  <!-- BOARD DIALOGS -->
  <dialog id="postDlg">
    <form id="postForm" method="dialog">
      <div class="dlgHead">
        <div style="font-weight:800" id="postDlgTitle">글쓰기</div>
        <button id="closePostDlg" class="btn" value="cancel" type="button">닫기</button>
      </div>
      <div class="dlgBody">
        <div class="field"><label>제목</label><input id="postTitle" type="text" placeholder="제목 입력"></div>
        <div class="field"><label>내용</label><textarea id="postBody" placeholder="내용 입력"></textarea></div>
      </div>
      <div class="dlgFoot">
        <button class="btn" value="cancel" type="button" id="cancelPostBtn">취소</button>
        <button class="btn accent" id="savePostBtn" type="submit">완료</button>
      </div>
    </form>
  </dialog>

  <dialog id="postViewDlg">
    <div class="dlgHead">
      <div style="font-weight:800" id="postViewTitle">글 제목</div>
      <button id="closePostViewDlg" class="btn" type="button">닫기</button>
    </div>
    <div class="dlgBody">
      <div class="muted" id="postMeta">작성자 · 날짜</div>
      <div id="postViewBody" class="card" style="white-space:pre-wrap;margin-top:8px"></div>
      <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">댓글</div>
        <div id="postViewActions"></div>
      </div>
      <div id="commentsWrap"></div>
      <div id="commentEditor" class="card" style="margin-top:8px">
        <div class="field"><label>댓글 내용</label><textarea id="commentBody" placeholder="댓글을 입력하세요"></textarea></div>
        <div style="display:flex;justify-content:flex-end;gap:8px">
          <button class="btn" id="cancelCommentBtn" type="button">지우기</button>
          <button class="btn accent" id="addCommentBtn" type="button">댓글 등록</button>
        </div>
      </div>
    </div>
  </dialog>

  <script type="module" src="./app.js"></script>
</body>
</html>
